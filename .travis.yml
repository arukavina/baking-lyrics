language: python
python:
- '3.7'
install: pip install -r requirements/prd.txt
cache: pip
branches:
  only:
  - master
before_script:
- export PYTHONPATH=$PWD
- export APP_CONFIG_FILE=config/testing.py
- python baking/refresh_database.py
script:
- coverage erase
- coverage run baking/tests/test_general.py
- coverage run -a baking/tests/test_config.py
- coverage run -a baking/tests/test_songs.py
- coverage html
after_success:
- codecov
before_deploy:
- zip -r latest *
- mkdir -p dpl_cd_upload
- mv latest.zip dpl_cd_upload/latest.zip
deploy:
  provider: heroku
  app: baking-lyrics
  strategy: git
  api_key:
    secure: OBQGzSbiOSqucZ7yv99mE1HyQlpQh5xocms+LT3MSzEpjCrocBTsW8uWgCNvKyAI8dNdO56V5xKxLxEZSH57qUjmNrShlhE8f2UdhMRdjjoxwqe1JahBCLVQB8qa/5Pz8+v6SwF/WCk29m2SjI8yFSnqR4XmvDNXSNAP/ZbU6X5X2E2HsRtfVJO6WxIYNKB+Vh1m+bMdc4sMH2VC7RHXexvq8CsL59wQQLE/z8b55mvUt4wcGR2XhBZzGxPcVJVQT0VZFevy7Fiwwnem9q7y+/HFd1vHjKlN1uIBdjqWADPFNvJ5+fjpkVZl2crDNsBFgwTZYD9cdHSaBV8IE498ttvCrQwklzD6afO5oT7oiJUeLv9wmHhRgOqwjdk7JzTvIdzCPNW9QyOy5lRE1+fiYvaUUfmU61onkR1GoSlmEAeCRRILTdIcQgnt91xgfJCOAA/vuRsDdN3Rhj+NJB/YBMIf1YwN3X/aQiAdtDJ4nMxpP9VujG+zXyoDwuovSE090Xo7Fr3WrA17VA8lGw8++dKuxglMr4Hc3N4IDzAjnGnFDiAS/qLxS5pgaRmD5aRNZArA5HJWftZ1pOTVvFryK5FZh1W0J9i7ORfbMa3eacVlPg1dV+cV4qrcLDT7p3ZweBWQFyyW8B2KKASKP5UUn+6LzfTusLTsCOwDLLAq0IY=
after_deploy: 
